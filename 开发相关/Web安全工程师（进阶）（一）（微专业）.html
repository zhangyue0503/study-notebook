<html>
<head>
  <title>Web安全工程师（进阶）（一）（微专业）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/608449 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
	body, td {
	  font-family: 微软雅黑;
	  font-size: 12pt;
	}
  </style>
</head>
<body>
<a name="1134"/>
<h1>Web安全工程师（进阶）（一）（微专业）</h1>

<div><span><div><font style="font-size: 36px;"><span style="font-size: 36px; font-weight: bold;">SQL注入漏洞原理与利用</span></font></div><div><span style="font-size: 24px; font-weight: bold;">一、SQL注入基础</span></div><div><span style="font-size: 18px; font-weight: bold;">A.Web应用架构分析</span></div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">B.SQLi注入环境搭建</span></div><div>1.https://github.com/Audi-1/sqli-labs，注入练习工具</div><div>2.docker run -dt --name sqli -p 8111:80 --rm acgpiano/sqli-labs</div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">C.SQL注入原理分析</span></div><div>1.结构化查询语言SQL是一种介于关系代数与关系演算之间的语言，其功能包括查询、操纵、定义和控制四个方面</div><div>2.SQL注入产生原因：在编写代码时没有对用户的输入数据或者是页面中所携带的信息进行必要的合法性判断，攻击者提交一段数据库查询代码，根据程序返回的结果，就可以获得一些数据库信息</div><div>3.SQL注入是一种将恶意的SQL代码插入或添加到应用（用户）的输入参数的攻击，攻击者探测出开发者编程过程中的漏洞，利用这些漏洞，巧妙的构造SQL语句，对数据库系统的内容进行直接检索或修改</div><div>4.产生的原因：灵活的SQL查询语句+用户输入的数据带入了SQL语句=用户直接操作数据库=&gt;SQL注入漏洞</div><div>5.用户输入可控，代码对用户输入进行了拼接，带入SQL语句，产生SQL注入漏洞：select id,location from jobs where id=1 union select 1,version()</div><div>6.SQLi注入测试：</div><div><a href="http://localhost:8111/Less-1/?id=-11%27%20union%20select%201,2,version();%23">http://localhost:8111/Less-1/?id=-1%27%20union%20select%201,2,version();%23</a></div><div>http://localhost:8111/Less-1/?id=-1' union select 1,2,version();#</div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">D.MySQL注入方法逻辑运算及常用函数</span></div><div>1.mysql内置函数：https://dev.mysql.com/doc/refman/5.7/en/dynindex-function.html</div><div>2.MySQL注入常用函数：</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image.png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [1].png" type="image/png" data-filename="Image.png"/><br/></div><div>3.MySql运算符</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [2].png" type="image/png" data-filename="Image.png"/><br/></div><div>4.MySql逻辑运算：AND、OR</div><div>5.万能密码：’or ‘1’=‘1</div><div>6.MySql注入语句样例分析</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [3].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">E.SQL注入流程</span></div><div>1.寻找SQL注入点</div><ul><li><div>1）目标搜集：</div></li><ul><li><div>无特定目标：inure:.php?id=</div></li><li><div>有特定目标：inure:.php?id= sit:target.com</div></li><li><div>工具爬取：spider，对搜索引擎和目标网站的链接进行爬取</div></li></ul><li><div>2）注入识别：</div></li><ul><li><div>手工简单识别：’；and 1=1 / and 1=2；and ‘1’=‘1 / and ‘1’=‘2；and 1like 1 / and 1like 2</div></li><li><div>工具识别：sqlmap -m filename（filename中保存检测目标）；sqlmap —crawl（sqlmap对目标网站进行爬取，然后依次进行测试）</div></li></ul><li><div>3）高级识别：</div></li><ul><li><div>扩展识别广度和深度：sqlmap —level增加测试级别，对header中相关参数也进行测试；sqlmap -r filename（filename中为网站请求数据）</div></li><li><div>利用工具提高识别效率：BurpSuite+Sqlmap；BurpSuite拦截所有浏览器访问提交的数据；BurpSuite扩展插件，直接调用SqlMap进行测试</div></li><li><div>一些Tips：可以在参数后键入”*”来确定想要测试的参数；可能出现注入的点：新闻、登录、搜索、留言……；站在开发的角度去寻找</div></li></ul><li><div>4）代码审计</div></li><ul><li><div>搜索关键代码和函数</div></li><li><div>梳理业务流程</div></li></ul></ul><div>2.SQL注入流程</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [4].png" type="image/png" data-filename="Image.png"/><br/></div><div>3.信息搜集</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [5].png" type="image/png" data-filename="Image.png"/><br/></div><div>4.获取数据</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [6].png" type="image/png" data-filename="Image.png"/><br/></div><div>5.提权</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [7].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">F.SQL手工注入方法</span></div><div>1.MySQL数据库结构</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [8].png" type="image/png" data-filename="Image.png"/><br/></div><div>2.SQL层的功能</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [9].png" type="image/png" data-filename="Image.png"/><br/></div><div>3.MySQL内置库</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [10].png" type="image/png" data-filename="Image.png"/><br/></div><div>4.SQL手工注入核心原理：MySQL内置的information_schema库，它功能强大，是我们进行MySQL注入的基石！通过information_schema我们可以窥透整个MySQL的运行情况，也可以查看到数据库中所有的数据信息</div><div>5.查询数据核心语法</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [11].png" type="image/png" data-filename="Image.png"/><br/></div><div>6.注意点：</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [12].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">G.实验一：SQL注入漏洞原理及防范</span></div><div>1.firefox：HackBar</div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">H.实验二：SQLmap工具的使用—SQLmap初步</span></div><div><br/></div><div><br/></div><div><span style="font-size: 24px; font-weight: bold;">二、SQL注入语法类型</span></div><div><span style="font-size: 18px; font-weight: bold;">A.union联合查询注入</span></div><div>1.SQL UNION操作符</div><ul><li><div>1）UNION操作符用于合并两个或多个SELECT语句的结果集</div></li><li><div>2）注意，UNION内部的SELECT语句必须拥有相同数量的列。列也必须拥有相似的数据类型。同时，每条SELECT语句中的列的顺序必须相同</div></li><li><div>3）默认情况，UNION操作符选取不同的值。如果允许重复的值，请使用UNION ALL</div></li></ul><div>2.UNION注入应用场景</div><ul><li><div>1）只有最后一个SELECT子句允许有ORDER BY</div></li><li><div>2）只有最后一个SELECT子句允许有LIMIT</div></li><li><div>3）只要UNION连接的几个查询的字段数一样且列的数据类型转换没有问题，就可以查询出结果</div></li><li><div>4）注入点页面有回显</div></li></ul><div>3.UNION注入过程</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [13].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">B.报错注入</span></div><div>1.报错注入原理：</div><ul><li><div>构造payload让信息通过错误提示回显出来</div></li><li><div>应用场景：查询不回现内容，会打印错误信息；update、insert等语句，会打印错误信息</div></li></ul><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [14].png" type="image/png" data-filename="Image.png"/><br/></div><div>2.报错注入方法：凡是可以让错误信息显示的函数（语句）都能实现报错注入</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [15].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><a href="http://localhost:8111/Less-1/?id=1">http://localhost:8111/Less-1/?id=1</a>' and (select count(*) from information_schema.tables group by concat((select version()), floor(rand(0)*2)))—+</div><div><br/></div><div><a href="http://localhost:8111/Less-1/?id=1">http://localhost:8111/Less-1/?id=1</a>' and (select count(*) from information_schema.tables group by concat((select user()), floor(rand(0)*2)))—+</div><div><br/></div><div><a href="http://localhost:8111/Less-1/?id=1">http://localhost:8111/Less-1/?id=1</a>' and (select count(*) from information_schema.tables group by concat((select column_name from information_schema.columns where table_name='users' limit 0,1), 0x7e,floor(rand(0)*2)))—+</div><div><br/></div><div><a href="http://localhost:8111/Less-1/?id=1">http://localhost:8111/Less-1/?id=1</a>' and updatexml(1,concat(0x7e,(select user())),1)--+</div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">C.实验一：SQLmap工具的使用-POST注入</span></div><div>1.POST注入：--method POST</div><div>2.当前连接数据库用户名：--current-user</div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">D.实验二：SQLmap工具的使用-cookie注入</span></div><div>1.指定--level 2，大于等于2时，会检查cookie里的参数，&gt;=3时，会检查User-agent和Referer</div><div>2.指定cookie：--cookie “&quot;</div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">E.实验三：SQLmap工具的使用-执行SQL命令</span></div><div>1.执行sql语句：--sql-query</div><div>2.进入交互式：--sql-shell</div><div>3.一次性执行文件：--sql-file</div><div><br/></div><div><span style="font-size: 24px; font-weight: bold;">三、SQL盲注</span></div><div><span style="font-size: 18px; font-weight: bold;">A.SQL盲注—布尔盲注</span></div><div>1.布尔盲注原理</div><ul><li><div>1）代码存在SQL注入漏洞，然而页面即不会回显数据，也不会回显错误信息，只返回“Right”与“Wrong”</div></li><li><div>2）这里我们可以通过构造语句，来判断数据库信息的正确性，再通过页面的“真”和“假”来识别我们的判断是否正确，这就是布尔盲注</div></li></ul><div>2.布尔盲注方法</div><ul><li><div>1）构造逻辑判断语句，判断信息的真假，取出所有的真值，实现SQL注入</div></li></ul><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [16].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><a href="http://localhost:8111/Less-8/?id=1">http://localhost:8111/Less-8/?id=1</a>' and left((select table_name from information_schema.tables where table_schema=database() limit 0,1), 1)=‘e’--+</div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">B.SQL盲注—时间注入</span></div><div>1.时间盲注原理</div><ul><li><div>1）代码存在SQL注入漏洞，然而页面即不会回显数据，也不会回显错误信息；语句执行后也不提示真假，不能通过页面的内容来进行判断</div></li><li><div>2）通过构造语句，通过页面的响应时长，来判断信息，这就是时间盲注</div></li></ul><div>2.构造逻辑语句，通过条件语句进行判断，为真则立即执行，否则延时执行</div><ul><li><div>1）核心语法：if(left(user(),1)=‘a’,0,sleep(3))</div></li></ul><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [17].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><a href="http://127.0.0.1:8111/Less-10/?id=1">http://127.0.0.1:8111/Less-10/?id=1</a>&quot; and  if(left(user(), 1)='r',0, sleep(3))--+</div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">C.Dnslog盲注</span></div><div>1.Dnslog盲注原理：减少盲注请求次数</div><ul><li><div>1）Dnslog平台：http://ceye.io/</div></li><li><div>2）DNS在解析的时候会留下日志，通过读取多级域名的解析日志，获取信息请求信息</div></li></ul><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [18].png" type="image/png" data-filename="Image.png"/><br/></div><div>2.构造语句，利用load_file()函数发起请求，使用Dnslog接受请求，获取数据</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [19].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">D.实验1：SQL盲注手工注入测试</span></div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">E.实验2：BurpSuite盲注</span></div><div><br/></div><div><span style="font-size: 24px; font-weight: bold;">四、SQL注入防御绕过</span></div><div><span style="font-size: 18px; font-weight: bold;">A.宽字节注入</span></div><div>1.两字节为宽字节</div><div>2.宽字节注入原理：</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [20].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [21].png" type="image/png" data-filename="Image.png"/><br/></div><div>3.宽字节注入方法</div><ul><li><div>1）在注入点后键入%df，然后按照正常的注入流程开始注入</div></li></ul><div>4.如何发现</div><ul><li><div>1）黑盒：在可能的注入点后键入%df，之后注入测试</div></li><li><div>2）白盒：</div></li><ul><li><div>查看MySQL编码是否为GBK</div></li><li><div>是否使用preg_replace把单引号转换成\’</div></li><li><div>是否使用addslashes进行转义</div></li><li><div>是否使用mysql_real_escape_string进行转义</div></li></ul></ul><div>5.宽字节防御</div><ul><li><div>1）使用utf-8连接数据库</div></li><li><div>2）使用mysql_real_escape_string，一定要设置mysql_set_charset(‘gbk’, $conn)</div></li><li><div>3）可以设置参数，character_set_client=binary，使用二进制模式</div></li></ul><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">B.二次编码注入</span></div><div>1.二次编码注入原理</div><ul><li><div>1）宽字节注入和二次编码注入是在面对PHP代码或配置，对输入的’（单引号）进行转义的时候，在处理用户输入数据时存在问题，可以绕过定义</div></li><li><div>2）宽字节注入：GBK编码处理编码的过程存在问题，可构造数据消灭\</div></li><li><div>3）二次编码注入：urldecode()与PHP本身处理编码时，两者配合失误，可构造数据消灭\</div></li></ul><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [22].png" type="image/png" data-filename="Image.png"/><br/></div><div>2.注入方法：在注入点键入%2527，然后按照正常的注入流程开始注入</div><div>3.发现注入：</div><ul><li><div>1）黑盒：在可能的注入点后键入%2527，之后进行注入测试</div></li><li><div>2）白盒：</div></li><ul><li><div>是否使用urldecode函数</div></li><li><div>urldecode函数是否在转义方法之后</div></li></ul></ul><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">C.二次注入</span></div><div>1.二次注入原理</div><ul><li><div>1）插入恶意数据：第一次进行数据库插入数据的时候，仅仅对其中的特殊字符进行了转义，在写入数据库的时候还是保留了原来的数据，但是数据本身包含恶意内容</div></li><li><div>2）引用恶意数据：将数据存入到了数据库中之后，开发者就认为数据是可信的。在下一次需要进行查询的时候，直接从数据库中取出了恶意数据，没有进行进一步的检验和处理，这样就会造成SQL的二次注入</div></li></ul><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [23].png" type="image/png" data-filename="Image.png"/><br/></div><div>2.二次注入防御</div><ul><li><div>1）对外部提交的数据，需要更加谨慎的对待</div></li><li><div>2）程序内部的数据调用，也要严格的进行检查，一旦不小心，测试者就能将特定的SQL语句带入到查询中</div></li></ul><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">D.WAF绕过原理分析</span></div><div>1.WAF：Web Application Firewall</div><div>2.绕过原理：熟练掌握MySQL函数和语法使用方法+深入了解中间件运行处理机制+了解WAF防护原理及方法=随心所欲的绕过WAF的防护</div><div>3.白盒绕过</div><ul><li><div>1）分析代码</div></li><li><div>2）绕过限制</div></li><ul><li><div>大小写变形：Or，OR，oR</div></li><li><div>等价替换：and=&gt;&amp;&amp;，or=&gt;||</div></li></ul></ul><div>4.黑盒绕过</div><ul><li><div>1）架构层绕过：</div></li><ul><li><div>寻找源站=&gt;针对云WAF</div></li><li><div>利用同网段=&gt;绕过WAF防护区域</div></li><li><div>利用边界漏洞</div></li></ul><li><div>2）资源限制角度绕过：POST大BODY</div></li><li><div>3）协议层面绕过</div></li><ul><li><div>协议未覆盖：请求方式变换（GET=&gt;POST）；Content-Type变换：application/x-www-form-urlencoded;=&gt;multipart/form-data;</div></li><li><div>参数污染</div></li></ul><li><div>4）规则层面的绕过</div></li></ul><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [24].png" type="image/png" data-filename="Image.png"/><br/></div><div>5.Fuzz绕过</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [25].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">E.SQLmap绕过WAF脚本编写</span></div><div>1.sqlmap注入常用命令</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [26].png" type="image/png" data-filename="Image.png"/><br/></div><div>2.sqlmap tamper脚本</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [27].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [28].png" type="image/png" data-filename="Image.png"/><br/></div><div>3.%a0，%0a，可以替换空格</div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">F.实验一：SQLmap注入原理及规范—下</span></div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">G.实验二：SQLmap之temper</span></div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">H.实验三：突破安全狗</span></div><div><br/></div><div><span style="font-size: 24px; font-weight: bold;">五、MySQL数据库注入</span></div><div><span style="font-size: 18px; font-weight: bold;">A.MSSQL环境搭建</span></div><div>1.MSSQL特点</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [29].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [30].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [31].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [32].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><a href="https://websec.ca/kb/sql_injection">https://websec.ca/kb/sql_injection</a></div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">B.MSSQL注入（一）</span></div><div>1.存储过程</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [33].png" type="image/png" data-filename="Image.png"/><br/></div><div>2.注入流程：MSSQL自带大量的存储过程，因此，针对MSSQL的注入可利用存储过程，来进行提权操作</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [34].png" type="image/png" data-filename="Image.png"/><br/></div><div>3.注入流程</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [35].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [36].png" type="image/png" data-filename="Image.png"/><br/></div><div>4.权限探测</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [37].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [38].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [39].png" type="image/png" data-filename="Image.png"/><br/></div><div>5.写入文件</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [40].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [41].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [42].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">C.MSSQL注入（二）</span></div><div>1.sqlmap+jonhnny破解口令</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [43].png" type="image/png" data-filename="Image.png"/><br/></div><div>2.cmder：windows下命令行工具；python2\3切换工具：Anaconda</div><div>3.jonhnny工具</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [44].png" type="image/png" data-filename="Image.png"/><br/></div><div>4.Sysadmin扩展攻击方式</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [45].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [46].png" type="image/png" data-filename="Image.png"/><br/></div><div>5.使用PowerUpSQL简化攻击</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [47].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [48].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [49].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><span style="font-size: 24px; font-weight: bold;">六、Oracle数据库注入</span></div><div><span style="font-size: 18px; font-weight: bold;">A.Oracle数据库环境搭建</span></div><div>1.Oracle特点</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [50].png" type="image/png" data-filename="Image.png"/><br/></div><div>2.权限传递</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [51].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">B.Oracle数据库注入（一）</span></div><div>1.Oracle注入基本语法</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [52].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [53].png" type="image/png" data-filename="Image.png"/><br/></div><div>2.报错注入</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [54].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [55].png" type="image/png" data-filename="Image.png"/><br/></div><div>3.布尔盲注</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [56].png" type="image/png" data-filename="Image.png"/><br/></div><div>4.时间盲注</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [57].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [58].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [59].png" type="image/png" data-filename="Image.png"/><br/></div><div>5.外带通信</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [60].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">C.Oracle数据库注入（一）</span></div><div>1.提权</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [61].png" type="image/png" data-filename="Image.png"/><br/></div><div>2.执行java</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [62].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [63].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [64].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [65].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [66].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [67].png" type="image/png" data-filename="Image.png"/><br/></div><div>3.命令执行提升权限</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [68].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [69].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [70].png" type="image/png" data-filename="Image.png"/><br/></div><div>4.反弹Shell</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [71].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">D.实验一：Access手工注入</span></div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">E.实验二：MSSQL手工注入</span></div><div><br/></div><div><span style="font-size: 24px; font-weight: bold;">七、SQLMap实战进阶</span></div><div><span style="font-size: 18px; font-weight: bold;">A.SQLMap实战进阶（一）</span></div><div>1.SQLMap准备工作</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [72].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [73].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [74].png" type="image/png" data-filename="Image.png"/><br/></div><div>2.SQLMap的conf</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [75].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [76].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [77].png" type="image/png" data-filename="Image.png"/><br/></div><div>3.SQLMap工作流程</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [78].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [79].png" type="image/png" data-filename="Image.png"/><br/></div><div>4.*的误区</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [80].png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [81].png" type="image/png" data-filename="Image.png"/><br/></div><div>5.SQLMap的target</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [82].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">B.SQLMap实战进阶（二）</span></div><div>1.一个奇葩的注入</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [83].png" type="image/png" data-filename="Image.png"/><br/></div><div>2.tips：payload中的几个函数</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [84].png" type="image/png" data-filename="Image.png"/><br/></div><div>3.检测的payload在哪里：sqlmap/xml/payloads</div><div>4.Pyload</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [85].png" type="image/png" data-filename="Image.png"/><br/></div><ul><li><div>1）payload=where+boundary.prefix+test.payload+boundary.suffix</div></li></ul><div>5.level</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [86].png" type="image/png" data-filename="Image.png"/><br/></div><div>6.risk</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [87].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 36px; font-weight: bold;">文件上传漏洞原理与利用</span></div><div><span style="font-weight: bold; font-size: 24px;">一、文件上传漏洞原理与流程</span></div><div><span style="font-weight: bold; font-size: 18px;">A.文件上传漏洞原理</span></div><div>1.文件上传</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [88].png" type="image/png" data-filename="Image.png"/><br/></div><div>2.文件上传漏洞</div><ul><li><div>1）当文件上传点未对上传的文件进行严格的验证和过滤时，就容易造成做任意文件上传，包括上传动态文件（asp/php/jsp等等）</div></li><li><div>2）如果上传的目标目录没有限制执行权限，导致所上传的动态文件（比如webshell）可以正常执行并且可以访问，即造成了文件上传漏洞</div></li></ul><div>3.存在上传漏洞的必要条件是</div><ul><li><div>1）存在上传点</div></li><li><div>2）可以上传动态文件</div></li><li><div>3）上传目录有执行权限，并且上传的文件可执行</div></li><li><div>4）可访问到上传的动态文件</div></li></ul><div><br/></div><div><span style="font-weight: bold; font-size: 18px;">B.文件上传检测流程</span></div><div>1.上传检测流程</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [89].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><span style="font-weight: bold; font-size: 18px;">C.BurpSuite相关</span></div><div>1.SwitchyOmega插件，chrome、firefox</div><div><br/></div><div><span style="font-weight: bold; font-size: 24px;">二、前端检测绕过</span></div><div><span style="font-weight: bold; font-size: 18px;">A.客户端检测绕过</span></div><div>1.三类客户端检测</div><ul><li><div>1）JavaScript检测：通过浏览器提交上传请求前，触发检测用JS脚本进行检测</div></li><li><div>2）Flash AS脚本检测：上传用Flash中，提交上传请求前，触发检测用AS脚本进行检测</div></li><li><div>3）App上传检测：检测写在APP客户端代码中，或者所调用的HTML页面中</div></li></ul><div>2.客户端检测一般只检测文件扩展名。客户端进行的检测，可通过对客户端代码的一些修改或直接拦截修改报文即可绕过，所以这种上传限制约等于没有</div><div>3.前端JavaScript检测绕过</div><ul><li><div>1）查看onchange、onsubmit等事件</div></li><ul><li><div>onchange事件会在域的内容改变时发生</div></li><li><div>onsubmit事件会在表单中的确认按扭被点击时发生</div></li></ul><li><div>2）删除掉相关事件中的检测函数</div></li></ul><div><br/></div><div><span style="font-weight: bold; font-size: 18px;">B.提交报文修改检测</span></div><div>1.提交报文修改检测（前端检测通用）</div><ul><li><div>1）首先选择正常的文件进行上传</div></li><li><div>2）而后通过Burpsuite进行截包改包或改包重放完成文件上传</div></li><li><div>3）这种方法前端绕过检测中通用，无需理会具体前端的检测代码，直接绕过前端进行上传报文的修改并提交</div></li></ul><div>2.APP端BurpSuite抓包</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [90].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><span style="font-weight: bold; font-size: 18px;">C.实验一：文件上传漏洞原理及防范</span></div><div>1.漏洞危害：</div><ul><li><div>上传的文件若为Web脚本语言，服务器的Web容器解释并执行了攻击者上传的脚本（Webshell），则会导致代码执行，致使攻击者获取网站甚至整个系统的控制权。</div></li><li><div>上传文件为Flash的策略文件crossdomain.xml，则攻击者可以控制Flash在该域下的行为。</div></li><li><div>上传文件为病毒，木马等，攻击者可以诱骗用户或者网站管理员下载执行，作为下一步攻击的起点。</div></li><li><div>黑客可以连续不断地上传大文件，使网站运行缓慢，并可能发动拒绝服务攻击。</div></li><li><div>上产文件是钓鱼图片或包含了脚本的图片，在某些版本的浏览器中会被作为脚本直接执行。</div></li></ul><div>2.容易出现上传地方</div><ul><li><div>头像上传</div></li><li><div>图片&amp;视频分享</div></li><li><div>附件上传功能</div></li><li><div>文件管理器</div></li></ul><div>3.漏洞防护</div><ul><li><div>最佳防护代码：使用面向对象，编写相对严谨的上传upload class，每次上传调用，以从根本上防御文件上传漏洞，众多开源CMS也是利用次方式来解决文件上传问题。</div></li><li><div>服务端验证：客户端过滤，只能用于减轻服务器负担，提升服务器效率，服务端一切数据都可以伪造不可信, 在后端代码必须二次验证。</div></li><li><div>黑白名单过滤</div></li><li><div>快速解决方案</div></li></ul><div><br/></div><div><span style="font-weight: bold; font-size: 18px;">D.实验二：中国菜刀-文件管理</span></div><div>1.asp的一句话是：&lt;%eval request (&quot;pass&quot;)%&gt;</div><div>2.aspx的一句话是：&lt;%@ Page Language=&quot;Jscript&quot;%&gt; &lt;%eval(Request.Item[&quot;pass&quot;],&quot;unsafe&quot;);%&gt;</div><div>3.php的一句话是：&lt;?php @eval($_POST['pass']);?&gt;</div><div><br/></div><div><br/></div><div><span style="font-weight: bold; font-size: 24px;">三、服务端检测绕过</span></div><div><span style="font-weight: bold; font-size: 18px;">A.MIME类型检测绕过</span></div><div>1.MIME（Multipurpose Internet Mail Extensions）是描述消息内容类型的因特网标准。MIME消息能包含文本、图像、音频、视频以及其他应用程序专用的数据。浏览器会自动根据所上传的文件的扩展名，对应到相应的MIME类型上</div><div><br/></div><div><span style="font-weight: bold; font-size: 18px;">B.文件内容检测绕过</span></div><div>1.简单文件头检测</div><ul><li><div>文件头是位于文件开头的一段承担一定任务的数据，一般都在开头的部分</div></li><li><div>文件头的起始部分中一般开头标记文件类型。如git的文件头为GIF89a或GIF87a</div></li></ul><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [91].png" type="image/png" data-filename="Image.png"/></div><div>2.完整文件结构检测</div><ul><li><div>通过调用图像函数（如getimagesize、iamgecreatefromgif、imagecreatefrompng），进行文件检测是否为图像，需要文件内容保持相对完整，所以无法通过上种追加头部起始字节的方法进行绕过</div></li></ul><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [92].png" type="image/png" data-filename="Image.png"/></div><ul><li><div>针对这种检测，可以将图片文件与欲上传的文件进行合并来绕过检测。</div></li><li><div>可以通过copy命令进行文件合并。</div></li><li><div>合并后的文件只要未经过清洗或缩放等操作即可通过检测，并保持欲上传文件的完整</div></li><li><div>由于上传文件的图片部分在解析为PHP时会以乱码显示，建议与尽量小的图片文件进行合并，否则会有大量的乱码</div></li></ul><div>3.恶意文件内容检测</div><ul><li><div>检测提交内容中是否包含Webshell等数据</div></li><li><div>推荐使用强混淆的weevely进行尝试，Kali中自带：https://github.com.sunge/Weevely</div></li><li><div>或者尝试开源的webshell收集项目：https://github.com/tennc/webshell</div></li></ul><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [93].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><span style="font-weight: bold; font-size: 18px;">C.文件上传小技巧</span></div><div>1.文件参数多filename属性：文件上传过程中，如果存在waf拦截一些扩展名，可以通过尝试多个filename属性</div><div>2.目录可控时，可以尝试使用目录穿戴的方法（../）</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [94].png" type="image/png" data-filename="Image.png"/></div><div>3.扩展名检测类型可控</div><ul><li><div>1）可以从后台修改允许/禁止的扩展名类型</div></li><li><div>2）提交参数中存在允许/禁止的扩展名类型</div></li><li><div>3）前端单独抽出了文件扩展名进行了提交</div></li></ul><div><br/></div><div><br/></div><div><span style="font-weight: bold; font-size: 18px;">D.实验一：服务器检测绕过-MIME、目录路径</span></div><div>1.文件上传功能本身没有错，只是在一些条件下会被攻击者利用，从而成为漏洞，根据攻击原理，有以下几点应该注意：</div><ul><li><div>1）文件上传的目录设置为不可执行</div></li><li><div>2）判断文件类型</div></li><li><div>3）使用随机数改写文件名和文件路径</div></li></ul><div><br/></div><div><br/></div><div><span style="font-weight: bold; font-size: 18px;">E.实验二：上传绕过服务器黑名单、白名单检测</span></div><div>1.白名单绕过技巧</div><ul><li><div>1）0x00 截断绕过</div></li><li><div>2）解析调用/漏洞绕过</div></li></ul><div>2.黑名单绕过技巧</div><ul><li><div>1）后缀名大小写绕过</div></li><li><div>2）名单列表绕过</div></li><li><div>3）特殊文件名绕过</div></li><li><div>4）0x00 截断绕过</div></li><li><div>5）双扩展名解析绕过攻击-基于web服务的解析逻辑 。</div></li><li><div>6）双扩展名解析绕过攻击-基于web服务的解析方式</div></li></ul><div><br/></div><div><span style="font-weight: bold; font-size: 18px;">F.实验三：服务器端检测绕过-文件内容检测</span></div><div>1.文件头标识位于文件的开头部分，我们可以在恶意脚本文件开头部分伪造正常图片格式的标识，服务端提取上传文件的文件头标识时，提取到的是正常的图片头标识，就会判断该文件合法，保存在服务器上，这样攻击者就可以成功绕过服务端的检测而上传恶意脚本文件。</div><div>2.文件上传本身没有问题，有问题的是文件上传后，服务器怎么处理、解释文件。如果服务器的处理逻辑做的不够安全，则会导致严重的后果。</div><div>3.常见图片文件头标识(16进制表示)： 1.JPEG - 文件头标识 (2 bytes): 0xff, 0xd8 (SOI) (JPEG 文件标识) - 文件结束标识 (2 bytes): 0xff, 0xd9 (EOI) 2.PNG - 文件头标识 (8 bytes) 89 50 4E 47 0D 0A 1A 0A 3.GIF - 文件头标识 (6 bytes) 47 49 46 38 39(37) 61 GIF89(7)a 4.BMP - 文件头标识 (2 bytes) 42 4D BM </div><div><br/></div><div><span style="font-weight: bold; font-size: 18px;">G.实验四：FCK编辑器漏洞</span></div><div>1.客户端检测，使用JS对上传图片检测，包括文件大小、文件扩展名、文件类型等</div><div>2.服务端检测，对文件大小、文件路径、文件扩展名、文件类型、文件内容检测，对文件重命名</div><div>3.其他限制，服务器端上传目录设置不可执行权限</div><div><br/></div><div><span style="font-weight: bold; font-size: 24px;">四、解析漏洞</span></div><div><span style="font-weight: bold; font-size: 18px;">A.常见解析漏洞</span></div><div>1.IIS/Nginx+PHP fastcgi取值错误解析漏洞（配置错误）</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [95].png" type="image/png" data-filename="Image.png"/></div><div>2.Nginx文件名逻辑漏洞（CVE-2013-4547）</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [96].png" type="image/png" data-filename="Image.png"/></div><div>3.Apache解析漏洞（配置错误）</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [97].png" type="image/png" data-filename="Image.png"/></div><div>4.IIS 5.x/6.0解析漏洞</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [98].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><span style="font-weight: bold; font-size: 18px;">B.实验一：Apache解析漏洞</span></div><div>1.普通用户与系统管理员的权限要有严格的区分</div><div>2.强迫使用参数化语句</div><div>3.加强对用户输入的验证</div><div>4.多使用数据库自带的安全参数</div><div>5.使用专业的漏洞扫描工具来寻找可能被攻击的点</div><div><br/></div><div><span style="font-weight: bold; font-size: 18px;">C.实验二：IIS解析漏洞</span></div><div><br/></div><div><span style="font-weight: bold; font-size: 24px;">五、文件上传高级利用</span></div><div><span style="font-weight: bold; font-size: 18px;">A.图片重绘</span></div><div>1.重绘图</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [99].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><span style="font-weight: bold; font-size: 18px;">B.PHPINFO与图片包含的利用</span></div><div>1.phpinfo与本地文件包含的利用</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [100].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><span style="font-weight: bold; font-size: 18px;">C.在线<span style="font-weight: bold; font-size: 18px;">解</span>压缩漏洞利用</span></div><div>1.在线解压缩的利用</div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [101].png" type="image/png" data-filename="Image.png"/></div><div><img src="Web安全工程师（进阶）（一）（微专业）_files/Image [102].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div></span>
</div></body></html> 