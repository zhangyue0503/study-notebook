<html>
<head>
  <title>ElasticSearch可扩展的开源弹性搜索解决方案</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/608449 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
	body, td {
	  font-family: 微软雅黑;
	  font-size: 12pt;
	}
  </style>
</head>
<body>
<a name="2839"/>
<h1>ElasticSearch可扩展的开源弹性搜索解决方案</h1>

<div>
<span><div><span style="font-size: 24px;"><span style="font-size: 24px; font-weight: bold;">一、ElasticSearch集群入门</span></span></div><div><span style="font-weight: bold;">A.什么是ElasticSearch</span></div><div>1.概念：</div><ul><li>索引（index）：是ElasticSearch存放数据的地方</li><li>文档（document）：是ElasticSearch中存储的主要实体</li><li>文档类型：文档类型可以区分不同的对象</li><li>节点和集群：ElasticSearch支持在多台协同工作的服务器上运行</li><li>分片：节点的计算能力或硬件限制不够时，可以将数据切分，每部分是一个单独的Apache Lucene索引，称为分片（shard）</li><li>副本：为了提高查询的吞吐量或实现高可用性，可以启用分片副本，是对原始分片的一个精确拷贝</li></ul><div>2.状态查看：</div><ul><li>http://localhost:9200/</li><li>http://localhost:9200/_cluster/health?pretty</li></ul><div>3.操作：通过REST操作数据，GET、POST、PUT、DELETE</div><div><br/></div><div><span style="font-size: 24px;"><span style="font-size: 24px; font-weight: bold;">二、搜索数据</span></span></div><div><span style="font-weight: bold;">A.查询和索引的过程</span></div><div>1.索引过程：准备发磅到ES的文档并在索引中存储文档的过程</div><div>2.搜索过程：匹配满足查询条件的文档的过程</div><div>3.分析过程：预备字段内容，并将其转换为可以写放Lucene索引的词项（term）的过程</div><ul><li>词条化：输入文本被分词器转换为一个词条流</li><li>过滤：若干个过滤器处理词条流中的词条</li></ul><div>4.分析器：是带有零个或多个过滤器的分词器</div><div><br/></div><div><span style="font-weight: bold;">B.查询ElasticSearch</span></div><div>1.将多个简单查询封闭为一个JSON格式对象发送给ElasticSearch，称为：查询DSL</div><div>2.语法：</div><ul><li>curl -XGET 'localhost:9200/library/book/_search?q=title:crime&amp;pretty=true'</li><li>curl -XGET 'localhost:9200/library/book/_search?pretty=true' -d '{&quot;query&quot;:{&quot;term&quot;:{&quot;title&quot;:&quot;crime&quot;}}}'</li><li>curl -XGET 'localhost:9200/library/book/_search?pretty=true' -d @query.json</li></ul><div><br/></div><div><span style="font-weight: bold;">C.基本查询</span></div><div>1.term：匹配给定字段有某个词项的文档</div><div>2.terms：匹配包含某些词项的文档</div><div>3.match：提取参数中难写的取值，分析这些值 ，基于它们构建适当的查询</div><div>4.multi_match：与match类似，不同在于通过fields配置可作用于多个字段上</div><div>5.query_string：支持Apache Lucene所有的查询语法</div><div>6.field：query_string查询的简化版本</div><div>7.ids：过滤返回的文档，只得到其中包含指定标识符的文档，作用在_uid字段</div><div>8.prefix：找到某个字段以给定前缀开始的文档</div><div>9.fuzzy_like_this：查询得到与给定内容相似的所有文档，基于模糊串，并选择其产生的最好的区分词项</div><div>10.fuzzy_like_this_field：与fuzzy_like_this类似，区别在于只作用在单个字段，不支持fields属性</div><div>11.fuzzy：第三类模糊查询通过计算给定词项与文档的编辑距离来得到结果，消耗CPU资源，对需要模糊匹配的场景比较有用</div><div>12.match_all：匹配索引中所有文档的查询</div><div>13.wildcard：允许我们在要查询的内容中使用符*和?，在查询体部分与term非常相似，性能差</div><div>14.more_like_this：等到与所提供文本相似的文档</div><div>15.more_like_this_field：与more_like_this相似，不同在于只作用在半单个字段，不支持fields属性</div><div>16.range：可以在某个范围内在数值型字段和字符串型字段上查找文档，只作用在单个字段上，查询的参数封装在字段的名称中</div><div><br/></div><div><span style="font-weight: bold;">D.过滤查询结果</span></div><div>1.在query属性下添加filter字段就可以在任何搜索中使用过滤器</div><div>2.range：将搜索范围限制在字段取值在给定界限内的文档</div><div>3.exists：只选择有指定字段的文档</div><div>4.missing：与exists相反，还可以指定将哪些值作为空值处理</div><div>5.script：使用一个计算得到的值过过滤文档</div><div>6.type：返回符合指定类型的所有文档</div><div>7.limit：限制对给定查询的每个分片返回的文档数目</div><div>8.ids：适合需要过滤某些具体文档的场景</div><div>9.bool、and、or和not可以组合过滤器</div><div>10.使用&quot;_name&quot;可以命名过滤器</div><div><br/></div><div><span style="font-weight: bold;">E.复合查询</span></div><div>1.bool：should可以匹配也可以不匹配、must必须匹配、must_no必须不匹配</div><div>2.boosting：将两个查询封装在一起，并降低其中一个查询所返回文档的分值</div><div>3.constant_score：用于封装另一个查询（过滤器），被封闭查询（过滤器）返回的每个文档都得到一个恒定分值，允许我们严格控制赋予被查询或过滤器匹配的每个文档的分值</div><div>4.indices：需要在多个索引上执行一个查询时非常有用</div><div>5.custom_filters_score：允许我们封装一个查询和若干个过滤器</div><div>6.custom_boost_factor：允许我们封装另外一个查询，并将该查询返回的文档的分值乘以一个指定的因子</div><div>7.custom_score：通过script为另一个查询定制分值</div><div><br/></div><div><span style="font-weight: bold;">F.数据排序</span></div><div>1.&quot;sort&quot;:[{&quot;_score&quot;:&quot;desc&quot;}]，默认按得分最高的</div><div><br/></div><div><span style="font-weight: bold;">G.使用脚本</span></div><div>1.script：包含脚本代码；lang：指示脚本使用的语言，默认mvel；params：包含参数的对象</div><div>2.可用的对象：doc，访问基于计算分值或者字段取值找到的当前文档；_source，可以访问当前文档的源，以及在其中定义的取值 ；_fields，用于访问文档中的字段取值</div><div><br/></div><div><span style="font-size: 24px;"><span style="font-size: 24px; font-weight: bold;">三、扩展结构与搜索</span></span></div><div>1.关闭动态映射：dynamic:false</div><div>2.空间索引：geo_point</div><div><br/></div><div><span style="font-size: 24px;"><span style="font-size: 24px; font-weight: bold;">四、搜索优化</span></span></div><div>1.boost权值影响排序结果</div><div>2.同义词过滤器synonym</div><div>3.跨度查询：span_term、span_first、span_near、span_or、span_not，指一个字段中开始和结束的词条位置</div><div><br/></div><div><span style="font-size: 24px;"><span style="font-size: 24px; font-weight: bold;">五、组合索引、分析和搜索</span></span></div><div>1.父子映射：_parent</div><div>2.从其他系统获取数据：river</div><div><br/></div><div><span style="font-size: 24px;"><span style="font-size: 24px; font-weight: bold;">六、搜索之外</span></span></div><div>1.统计：query统计、filter统计、terms统计、range统计、histogram统计、statistical统计、terms_stats统计、geo_distance统计</div><div>2.相似</div><div>3.反查</div><div><br/></div><div><span style="font-size: 24px;"><span style="font-size: 24px; font-weight: bold;">七、管理集群</span></span></div><div><span style="font-weight: bold;">A.监控集群状态与健康状况</span></div><div>1.健康状态：curl http://localhost:9200/_cluster/health?pretty</div><div>2.索引统计：curl http://localhost:9200/library/_stats?pretty</div><div><br/></div><div><span style="font-weight: bold;">B.实例和集群状态诊断工具</span></div><div>1.Bigdesk插件</div><div>2.elasticsearch-head插件</div><div>3.elasticsearch-paramedic插件</div><div>4.SPM工具</div><div><br/></div><div><span style="font-weight: bold;">C.网关</span></div><div>1.可以使用本地、hadoop、Amazon s3</div><div><br/></div><div><span style="font-weight: bold;">D.节点探索</span></div><div>1.默认允许使用zen探索（zen discovery），并提供了多播（multicast）和单播（unicast）两种探索方法</div><div><br/></div><div><span style="font-size: 24px;"><span style="font-size: 24px; font-weight: bold;">八、问题处理</span></span></div><div>1.再平衡（rebalancing）是在集群中的各个不同的节点之间移动分片的过程</div><div>2.预热：_warmer</div><div><br/></div></span>
</div></body></html> 