<html>
<head>
  <title>Node.js中的定时器</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/608449 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
	body, td {
	  font-family: 微软雅黑;
	  font-size: 12pt;
	}
  </style>
</head>
<body>
<a name="2590"/>
<h1>Node.js中的定时器</h1>

<div><span><div><div style="padding: 0px;"><div style="padding: 40px 0px 20px; box-sizing: border-box;"><div style="padding: 0px;"><div style="padding: 0px; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; line-height: 1.5; word-wrap: break-word;"><div style="padding: 0px; box-sizing: border-box; line-height: 1.8em; margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; line-height: 1.8em;-en-paragraph:true;">这里我们只介绍3个非I/O异步接口，setTimeout、setImmediate和process.nextTick。
</span></div><div style="padding: 0px; box-sizing: border-box; line-height: 1.8em; margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; line-height: 1.8em;-en-paragraph:true;">在node.js的事件循环中，处理各种回调是有分多个阶段的，大致如下：
</span></div><div style="padding: 16px; overflow: auto; white-space: pre-wrap; word-wrap: normal; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; line-height: 1.45; border-radius: 3px; background-color: rgb(247, 247, 247);"><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">循环开始</span></div><div><br/></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">    执行setTimout、setInterval回调</span></div><div><br/></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">    执行I/O回调</span></div><div><br/></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">    执行setImmediate回调</span></div><div><br/></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">循环结束</span></div></div><h3 style="padding: 0px; line-height: 1.25; font-weight: bold; font-size: 1.25em; box-sizing: border-box;"><span style="line-height: 1.25; font-weight: bold; font-size: 1.25em; box-sizing: border-box;">setTimeout(callback, delay[, …arg])
</span></h3><div style="padding: 0px; box-sizing: border-box; line-height: 1.8em; margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; line-height: 1.8em;-en-paragraph:true;">计划在 delay 毫秒执行 callback。返回一个可能被 clearTimeout() 用到的 timeoutObject 。
</span></div><div style="padding: 0px; box-sizing: border-box; line-height: 1.8em; margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; line-height: 1.8em;-en-paragraph:true;">对照上面的的循环阶段不难理解，执行setTimeout的时机是在每次循环的开头，在这个阶段将会执行所有定时器时间到了或者超过的回调。
</span></div><div style="padding: 0px; box-sizing: border-box; line-height: 1.8em; margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; line-height: 1.8em;-en-paragraph:true;">需要注意的是这里如果上一个方法执行时间过长，可能导致定时器回调实际执行的时间被延后。
</span></div><div style="padding: 16px; overflow: auto; white-space: pre-wrap; word-wrap: normal; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; line-height: 1.45; border-radius: 3px; background-color: rgb(247, 247, 247);"><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: rgb(51, 51, 51); font-weight: bold;">function</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;"> </span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: rgb(153, 0, 0); font-weight: bold;">waste</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">(</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">time</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">) </span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">{</span></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">    </span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: rgb(51, 51, 51); font-weight: bold;">let</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;"> start = </span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: rgb(0, 134, 179);">Date</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">.now();</span></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">    </span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: rgb(51, 51, 51); font-weight: bold;">while</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">(</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: rgb(0, 134, 179);">Date</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">.now() - start &lt; time);</span></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">}</span></div><div><br/></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">setTimeout(</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">()</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;"> =&gt;</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;"> {</span></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">    </span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: rgb(0, 134, 179);">console</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">.log(</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: rgb(221, 17, 68);">'exec after 1000ms'</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">);</span></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">    waste(</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: teal;">5000</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">);</span></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">}, </span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: teal;">1000</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">);</span></div><div><br/></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">setTimeout(</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">()</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;"> =&gt;</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;"> {</span></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">    </span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: rgb(0, 134, 179);">console</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">.log(</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: rgb(221, 17, 68);">'exec after 2000ms'</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">);</span></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">}, </span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: teal;">2000</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">);</span></div></div><div style="padding: 0px; box-sizing: border-box; line-height: 1.8em; margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; line-height: 1.8em;-en-paragraph:true;">上面的代码1000ms后会执行第一个定时器的回调，在这个回调里面又会占用CPU至少5000ms时间，第二个定时器回调执行的时候已经要等到6000ms以后了。
</span></div><h3 style="padding: 0px; line-height: 1.25; font-weight: bold; font-size: 1.25em; box-sizing: border-box;"><span style="line-height: 1.25; font-weight: bold; font-size: 1.25em; box-sizing: border-box;">setImmediate(callback, [arg], [...])
</span></h3><div style="padding: 0px; box-sizing: border-box; line-height: 1.8em; margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; line-height: 1.8em;-en-paragraph:true;">计划“马上”执行 callback。返回一个 immediateObject 以供 clearImmediate() 在有需要的时候使用。
</span></div><div style="padding: 0px; box-sizing: border-box; line-height: 1.8em; margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; line-height: 1.8em;-en-paragraph:true;">按照上面的循环阶段，我们可以看到 setImmediate 是在循环的末尾阶段被执行。它不用指定延时时间，只要前面的I/O阶段回调被执行完立马会执行 setImmediate 指定的回调方法。
</span></div><div style="padding: 0px; box-sizing: border-box; line-height: 1.8em; margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; line-height: 1.8em;-en-paragraph:true;">相比 setTimeout(callback, 0)，setImmediate 是一个更好的选择，它在nodejs的内部实现更加高效。
</span></div><div style="padding: 0px; box-sizing: border-box; line-height: 1.8em; margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; line-height: 1.8em;-en-paragraph:true;">在 setImmediate 指定的回调中继续调用 setImmediate，其回调将会在下一轮循环的同样阶段被执行。因此可以递归调用达到每次 tick 都触发一次回调的效果：
</span></div><div style="padding: 16px; overflow: auto; white-space: pre-wrap; word-wrap: normal; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; line-height: 1.45; border-radius: 3px; background-color: rgb(247, 247, 247);"><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: rgb(51, 51, 51); font-weight: bold;">function</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;"> </span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: rgb(153, 0, 0); font-weight: bold;">execEachTick</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">() </span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">{</span></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">    setImmediate(execEachTick);</span></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">    </span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: rgb(0, 134, 179);">console</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">.log(</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: rgb(221, 17, 68);">'exec each tick'</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">);</span></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">}</span></div><div><br/></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">setImmediate(execEachTick);</span></div></div><h3 style="padding: 0px; line-height: 1.25; font-weight: bold; font-size: 1.25em; box-sizing: border-box;"><span style="line-height: 1.25; font-weight: bold; font-size: 1.25em; box-sizing: border-box;">process.nextTick(callback[, ...args])
</span></h3><div style="padding: 0px; box-sizing: border-box; line-height: 1.8em; margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; line-height: 1.8em;-en-paragraph:true;">计划“立即”执行 callback。不同于 setTimeout 跟 setImmediate，它没有特定的处理阶段，而是在每个阶段后面都可以执行其设定的回调方法。调用 process.nextTick 是最快速执行异步回调的方法。
</span></div><div style="padding: 0px; box-sizing: border-box; line-height: 1.8em; margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; line-height: 1.8em;-en-paragraph:true;">它的接口命名跟功能个人觉得跟 setImmediate 是反过来的（手动滑稽），process.nextTick 才是立即执行，而 setImmediate 是下一次tick执行。
</span></div><div style="padding: 0px; box-sizing: border-box; line-height: 1.8em; margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; line-height: 1.8em;-en-paragraph:true;">因此在process.nextTick不能递归的调用，因为递归的调用相当于无限循环：
</span></div><div style="padding: 16px; overflow: auto; white-space: pre-wrap; word-wrap: normal; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; line-height: 1.45; border-radius: 3px; background-color: rgb(247, 247, 247);"><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: rgb(51, 51, 51); font-weight: bold;">function</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;"> </span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent; color: rgb(153, 0, 0); font-weight: bold;">fn</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">() </span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">{</span></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">    process.nextTick(fn);</span></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">}</span></div><div><br/></div><div><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; box-sizing: border-box; border-radius: 3px; word-break: normal; white-space: pre; border: 0px; overflow: visible; word-wrap: normal; background: transparent;">process.nextTick(fn);</span></div></div></div></div></div></div></div><div><br/></div></span>
</div></body></html> 