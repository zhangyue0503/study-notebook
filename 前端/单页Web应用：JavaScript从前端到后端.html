<html>
<head>
  <title>单页Web应用：JavaScript从前端到后端</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/608449 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
	body, td {
	  font-family: 微软雅黑;
	  font-size: 12pt;
	}
  </style>
</head>
<body>
<a name="2059"/>
<h1>单页Web应用：JavaScript从前端到后端</h1>

<div>
<span><div><b><font style="font-size: 24px;">一、第一个单页应用</font></b></div><div><br/></div><div>/singlepagewebapplications/spa1.html</div><div><br/></div><div><b><font style="font-size: 24px;">二、温故JavaScript</font></b></div><div><b>A.高级变量提升和执行环境对象</b></div><div>1.提升：JS引擎在进入作用域时，会对代码分两轮处理。第一轮，初始化变量；第二轮，执行代码。</div><div>第一轮：声明并初始化函数参数；声明局部变量，包括将匿名函数赋给一个局部变更，但并不初始化它们；声明并初始化函数。</div><div>2.每当函数被调用的时候，就会产生一个执行环境。所有函数中定义的变量和函数都是执行环境的一部分。JS把变量作为属性保存在一个对象上，这个对象称为执行环境对象。</div><div>3.JS把声明和初始化的变量当作执行环境对象的属性。</div><div>4.由于可以在执行环境中调用函数，会产生很多层的深度。在执行环境中调用函数，会创建一个新的嵌套在已存在的执行环境内的执行环境</div><div><ul><li>在&lt;script&gt;标签内的所有东西都在全局执行环境中<br/></li><li>调用first_function，会在全局执行环境中创建一个新的执行环境<br/></li><li>在first_function中调用second_function，会在first_function中创建一个执行环境。second_function有权限访问在first_function的执行环境以及全局执行环境<br/></li><li>在全局中调用second_function，没有权限访问first_function中的执行环境<br/></li></ul></div><div><br/></div><div><b>B.作用域链</b></div><div>1.JS引擎首先在局部执行环境对象上查找。如果没有定义，则跳出作用域链，到创建它的执行环境中去，并且在该执行环境对象中查找变量的定义，依此类推，走到找到定义或者到达全局作用域为止。</div><div><br/></div><div><b>C.JavaScript对象和原型链</b></div><div>1.JS对象是基于原型（prototype-based）的，我们创建的对象，看起来像我们想要的所有这种类型的对象那样，然后告诉JS引擎，我们想要更多像这样的对象。</div><div>2.使用Object.create来创建JS对象时，能增添一种更像是基于原型的感觉，它把原型作为参数并返回一个对象，使用这种方式，可以在原型对象上定义共同的属性和方法，然后使用它来创建多个共享相同属性的对象。</div><div>3.原型链描述了JS引擎如何从对象查找到原型以及原型的原型，来定位对象的属性值。如果JS引擎在对象的原型上找不到该属性，它就查找原型的原型，依此类推。当JS到达能用的（generic）Object的原型，原型链就结束了。如果JS在原型链上的所有地方都找不到请求的属性，则返回undefined。</div><div>4.原型上的属性就像是从原型创建的对象上的静态变量</div><div><br/></div><div><b>D.函数——更深入的窥探</b></div><div>1.函数是JS中的第一类（first-class）对象。它们可以保存在变量中，可以有属性甚至可以作为参数传给调用函数。它们用于控制变量作用域以及提供私有变量和方法。</div><div>2.闭包是阻止垃圾回收器将变量从内存中移除的方法，使得在创建变量的执行环境的外面能够访问到该变量</div><div>3.必须记住，每次调用函数时都会创建一个唯一的执行环境对象。函数执行完后，执行对象就被丢弃，除非调用者引用 了它。如果函数返回的是一个数字，就不能引用函数的执行环境对象，但是，如果函数返回的是一个更复杂的结构，像是函数对象或者数组，将返回值保存到一个变量上，就创建了一个对执行环境的引用。</div><div><br/></div><div><b><font style="font-size: 24px;">三、开发Shell</font></b></div><div>1.Shell是单页应用的主控制器（master controller）</div><div><ul><li>渲染和管理功能容器<br/></li><li>管理应用状态<br/></li><li>协调功能模块<br/></li></ul></div><div>2.使用URI来驱动页面状态的解决方案，自然就锚接口模式（anchor interface pattern）</div><div>3.锚接口工具：<a href="https://github.com/mmikowski/urianchor">https://github.com/mmikowski/urianchor</a></div><div>使用独立的（independent）和关联的（dependent）键值对的概念来编码</div><div><a>http://……spa.html#!profile=on:uid,suzie|status,green</a>，表示</div><div>{</div><div>profile:’on’,</div><div>_profile={</div><div><span>    uid:’suzie’,</span><br/></div><div><span><span>    status:’green'</span><br/></span></div><div>}</div><div>}</div><div>4.#!，表示可以被搜索引擎索引</div><div><br/></div><div>/singlepagewebapplications/3/<br/></div><div><br/></div><div><b><font style="font-size: 24px;">四、添加功能模块</font></b></div><div>1.把功能模块当作第三方模块来开发</div><div>团队更加高效，开发人员可以根据模块来划分职责</div><div>应用常常表现良好，模块只管理它们所负责的应用部分</div><div>代码维护和重用变得更加容易，因为模块被很好地隔离了</div><div>2.分形MVC（FMVC）：分形是一种模式，它在所有层级上显示为自相似性（self-similarity）。在多个层级上采用重复的MVC就是分形MVC</div><div><br/></div><div>/singlepagewebapplications/4/<br/></div><div><br/></div><div><b><font style="font-size: 24px;">五、构建Model</font></b></div><div><br/></div><div>/singlepagewebapplications/5/<br/></div><div><br/></div><div><b><font style="font-size: 24px;">六、完成Model和Data模块</font></b></div><div><br/></div><div>/singlepagewebapplications/6/<br/></div><div><br/></div><div><b><font style="font-size: 24px;">七、Web服务器</font></b></div><div><br/></div><div>1.传统Web服务器，比如Apache，是比较弱的消息服务器，它们会为每个连接创建和分配一个进程（或者线程），并且只要链接保持着，进程就必须“活着”。它的理念是在响应请求时，尽可能快地把数据推出去，然后尽可能地关闭连接。</div><div>2.Node.js是一个非常出色的消息服务器。由于事件模型（event model），它不会为每个链接创建一个进程。当打开或关闭连接的时候，会进行记录，在打开和关闭连接期间会做些维护工作。因此在一般的硬件上能够处理几万甚至几十万的并发连接。</div><div><br/></div><div>/singlepagewebapplications/7/<br/></div><div><br/></div><div><b><font style="font-size: 24px;">八、服务器数据库</font></b></div><div><br/></div><div>/singlepagewebapplications/8/<br/></div><div><br/></div><div><b><font style="font-size: 24px;">九、单页应用发布准备</font></b></div><div><br/></div><div><b><font style="font-size: 24px;">附录A、JavaScript编码标准</font></b></div><div><b>A.代码布局和注释</b></div><div>1.使用一致的缩进和行长</div><div><ul><li>每级代码缩进两个空格<br/></li><li>使用空格缩进而不是制表符，因为制表符的位置还没有标准<br/></li><li>每行限制为78个字符<br/></li></ul></div><div>2.按段落组织代码</div><div><ul><li>按逻辑段落组织代码，段落之间要空行<br/></li><li>每一行最多只包含一条语句或赋值语句，但是允许每行同时声明多个变量<br/></li><li>运算符和变量之间要有空格，这样就能更容易地识别变量<br/></li><li>每个逗号之后要有空格<br/></li><li>在段落内，相似的运算符要对齐<br/></li><li>缩进注释，缩进量和所解释的代码相同<br/></li><li>每条语句的最后要有分号<br/></li><li>在一个控制结构中的所有语句要用大括号括起来<br/></li></ul></div><div>3.换行要一致</div><div><ul><li>在运算符的前面换行，因为人们检查 左列的所有运算符是很容易的<br/></li><li>把后续的语句缩进一个层次<br/></li><li>在逗号分隔符的后面换行<br/></li><li>方括号或者括号单独占一行<br/></li></ul></div><div>4.使用K&amp;R风格的括号</div><div><ul><li>如果可能，就使用单行<br/></li><li>把左括号、左花括号或者左方括号放在开始行的末尾<br/></li><li>在分隔符（括号、花括号或者方括号）的里面把代码缩进一个层级 <br/></li><li>右括号、右花括号或者右方括号单独占一行<br/></li></ul></div><div>5.使用空格来区别函数和关键字</div><div><ul><li>函数名后面没有空格<br/></li><li>关键字后面空一格<br/></li><li>当格式化for语句的时候，在每个分号的后面空一格<br/></li></ul></div><div>6.引号要一致</div><div>7.注释解释代码策略</div><div>8.给API和TODO添加文档</div><div><ul><li>解释后有重要的函数<br/></li><li>如果彬了代码，要解释为什么<br/></li></ul></div><div><br/></div><div><b>B.变量名</b></div><div>1.使用常见字符</div><div><ul><li>变量名使用a-z、A-Z、0-9、下划线和$符号<br/></li><li>变量名不要以数字开头<br/></li></ul></div><div>2.传达变量作用域</div><div><ul><li>当变量作用域是整个模块时使用驼峰式<br/></li><li>当变量作用域不是整个模块时使用下划线<br/></li><li>确保所有模块作用域内的变量至少有两个音节<br/></li></ul></div><div>3.要意识到变量类型是很重要的</div><div>4.命名布尔变量：使用单词is</div><div>5.命名字符串变量：str、id、date、html、msg、name、text、type</div><div>6.命名整型变量：int、count、index、i,j,k、time</div><div>7.命名数字变量：num、x,y,z、coord、ratio</div><div>8.命名正则变量：regex</div><div>9.命名数组变量：list</div><div>10.命名映射变量：map</div><div>11.命名对象变量：单名词、模块作用域的对象变量名具有两个或两个以上音节、jQuery对象有前缀$</div><div>12.命名函数变量：遵循动词+名词的形式（fn、curry、destory/remove、empty、fetch、get、make、on、save、set、store、update）、模块作用域两个或两个以上音节</div><div>13.命名未知类型的变量：包含data</div><div><br/></div><div><b>C.变量声明和赋值</b></div><div>1.创建新对象、映射或数组时，使用{}或[]，不要用new Object()或new Array()</div><div>2.使用工具方法复制对象和数组</div><div>3.一开始就在函数作用域内，使用单个var关键字，显式地声明所有的变量</div><div>4.不要使用块：JS没有块作用域</div><div>5.把所有函数赋给变量</div><div>6.当函数需要三个以上的参数时，使用具名参数（named arguments），因为位置参数的含义容易忘记且不能进行自我说明</div><div>7.每条变量赋值语句点用一行</div><div><br/></div><div><b>D.函数</b></div><div>1.使用工厂模式构造对象</div><div>2.避免伪类对象构造器：即不要使用new关键字来构造伪类，如果忘记new关键字，就会破坏全局名字空间，如果要使用请首字母大写</div><div>3.所有的函数在使用之前都要先声明</div><div>4.当函数被立即调用的时候，用括号将它包起来</div><div><br/></div><div><b>E.名字空间</b></div><div>1.使用单一的全局函数，把其他所有变量的作用域限制在该函数里面，就可以极大减少全局变量污染</div><div><br/></div><div><b>F.文件名和布局</b></div><div>1.名字空间：</div><div><ul><li>使用jQuery来操作DOM<br/></li><li>在构建自己的插件之前，先研究一下有没有第三方代码库<br/></li><li>避免在HTML中嵌入JS<br/></li><li>在上线前，对JS和CSS进行压缩（minify）、混淆和gzip压缩<br/></li></ul></div><div>2.JS文件：</div><div><ul><li>在HTML中，先引入第三方JS文件<br/></li><li>接着引入 我们自己的JS文件<br/></li><li>所有JS文件的后缀都为.js<br/></li><li>把所有的静态JS文件保存在叫做js的目录下<br/></li><li>根据名字空间来命名JS文件<br/></li><li>使用模板来创建所有的JS模板文件<br/></li></ul></div><div>3.JS文件与CSS文件与类名之间保持平行结构</div><div><ul><li>为会生成HTML的每个JS文件创建一个CSS文件<br/></li><li>所有CSS文件的后缀都为.css<br/></li><li>把所有的CSS文件保存在叫做css的目录下<br/></li><li>给CSS选择器加上模块名前缀<br/></li><li>状态指示器使用&lt;名字空间&gt;-x&lt;描述符&gt;和其他共享的类名<br/></li></ul></div><div><br/></div><div><b>G.语法</b></div><div>1.标签：语句的标签（label）是可选的，只有while、for和switch需要，应总使用大写，而且是单名词</div><div>2.语句：</div><div><ul><li>continue除非使用了标签，应该尽量避免使用<br/></li><li>do语句结尾要分号<br/></li><li>if的else应该另起一行<br/></li><li>return不要加括号，表达式和return关键字要在一行避免自动分号<br/></li><li>while语句要尽量避免使用，容易产生死循环<br/></li><li>with应该避免使用<br/></li></ul></div><div>3.其他语法</div><div><ul><li>避免逗号运算符<br/></li><li>避免赋值表达式<br/></li><li>总是使用===和!==<br/></li><li>避免混乱的加号和减号<br/></li><li>不要使用eval：不要使用eval，不要使用Function构造器，不要向setTimeout和setInterval传递字符串<br/></li></ul></div><div><br/></div><div><b><font style="font-size: 24px;">附录B.测试单页应用</font></b></div><div><ul><li>jasmine-query：可以“监视”jQuery事件<br/></li><li>mocha：流行的，和nodeunit类似，但测试报告要更好<br/></li><li>nodeunit：流行的，简单却强大的工具<br/></li><li>patr：使用promise进行异步测试<br/></li><li>vows：流行的异步BDD框架<br/></li><li>zombie：流行的、基于Webkit引擎的无头浏览器，可以测试完整的应用<br/></li></ul></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 